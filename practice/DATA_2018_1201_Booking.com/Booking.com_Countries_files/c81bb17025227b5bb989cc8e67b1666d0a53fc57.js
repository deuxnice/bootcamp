var _i_=this._i_||function(){},_r_=this._r_||function(e){return e},_sp_=this._sp_||function(e){B.et.customGoal("cDPPESHbfNFVTAYZSQDZET",1),B.reportError({message:"SPDR function called - "+e},"SPDR")};!function(o,t){"use strict";_i_("2de:800e1319");var r=o.performance||o.mozPerformance||o.msPerformance||o.webkitPerformance||{},i=!(!r||!r.getEntriesByName),a=!(!i||!r.now),d={},c=booking.env.b_debug_dc_performance_metrics;function _(e){_i_("2de:6bf89d8b");var t="";for(var n in e)if("perf"==n)for(var o in e[n])null!=e[n][o]&&(t+="p_"+encodeURIComponent(o)+"="+encodeURIComponent(e[n][o])+"&");else t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";c&&console.log("Publishing metrics: "+JSON.stringify(e)),new Image(1,1).src="//cexp.booking.com/dc_performance.png?"+t,_r_()}var n=function(){if(_i_("2de:5ac86f49"),0==d[this.uid])return c&&console.log("[SUCCESS] Skipping duplicate response for "+this.uid),_r_();var e;c&&console.log("[SUCCESS] Clearing timeout callback for "+this.uid),o.clearTimeout(d[this.uid]),d[this.uid]=!1;var t=function(e){if(_i_("2de:fe64cd66"),i){var t=r.getEntriesByName(e);if(t&&t.length)return _r_(t[0])}_r_()}(this.src);if(t)c&&console.log("Loading performance metrics for "+this.uid),e=parseInt(t.responseEnd-t.fetchStart,10),_({id:this.uid,ms:isNaN(e)?-1:e,perf:{connect_end:t.connectEnd,connect_start:t.connectStart,domain_lookup_end:t.domainLookupEnd,domain_lookup_start:t.domainLookupStart,dom_complete:t.domComplete,dom_content_loaded_event_end:t.domContentLoadedEventEnd,dom_content_loaded_event_start:t.domContentLoadedEventStart,dom_interactive:t.domInteractive,dom_loading:t.domLoading,fetch_start:t.fetchStart,load_event_end:t.loadEventEnd,load_event_start:t.loadEventStart,navigation_start:t.navigationStart,redirect_end:t.redirectEnd,redirect_start:t.redirectStart,request_start:t.requestStart,response_end:t.responseEnd,response_start:t.responseStart,secure_connection_start:t.secureConnectionStart,unload_event_end:t.unloadEventEnd,unload_event_start:t.unloadEventStart}});else{c&&console.log("Calculating basic timing data for "+this.uid);var n=a?r.now():+new Date;e=parseInt(n-this.start_time,10),_({id:this.uid,ms:e>this.timeout?-1:e})}_r_()},s=function(){if(_i_("2de:7986b5cf"),0==d[this.uid])return c&&console.log("[SUCCESS] Skipping duplicate response for "+this.uid),_r_();c&&console.log("[ERROR] Clearing timeout callback for "+this.uid),o.clearTimeout(d[this.uid]),d[this.uid]=!1,_({id:this.uid,error:1}),_r_()},u=function(t){return _i_("2de:8b12a1fa"),c&&console.log("Creating image object for: "+JSON.stringify(t)),_r_(function(){_i_("2de:1bb0a585");var e=new Image(1,1);e.uid=t.uid,e.timeout=1e3*t.timeout,e.onerror=s,e.onload=n,d[t.uid]=setTimeout(function(){_i_("2de:2b958c12"),d[t.uid]=!1,_({id:t.uid,error:2}),_r_()},1e3*t.timeout),e.src=t.url,e.start_time=a?r.now():+new Date,_r_()})};o.dclmetrics=function(e){if(_i_("2de:6fa56264"),c&&console.log("Got callback: "+JSON.stringify(e)),e&&e.length&&"[object Array]"===Object.prototype.toString.call(e))for(var t=0;t<e.length;t++)setTimeout(u(e[t]),0);_r_()};var e=function(){_i_("2de:c9afb156"),setTimeout(function(){_i_("2de:fdc1b530");var e=t.createElement("script");e.src="//cexp.booking.com/dc_performance.js",t.getElementsByTagName("head")[0].appendChild(e),_r_()},2e3),_r_()};o.addEventListener?o.addEventListener("load",e,!1):o.attachEvent&&o.attachEvent("onload",e),_r_()}(window,document);